var SpaceInvaders={config:{ENEMY_COLUMNS:10,ENEMY_ROWS:6,ENEMY_TYPES:3,ENEMY_TYPE_NAME:"alien",ENEMY_WIDTH:36,ENEMY_HEIGHT:41,ENEMY_VERTICAL_MARGIN:10,ENEMY_HORIZONTAL_MARGIN:10,STAGE_WIDTH:null,STAGE_HEIGHT:null},init:function(){var f=this.config.ENEMY_COLUMNS,a=this.config.ENEMY_ROWS,m=this.config.ENEMY_TYPES,h=f*a,l=h/m,b=a/m,c,n,g,e,d;this._active=[];this._active.push(this.enemiesCollection.init());this._active.push(this.player.init());this._active.push(this.stage.init(this.config.STAGE_WIDTH,this.config.STAGE_HEIGHT));g=m;e=a-1;while(e>=0){n=$.beget(SpaceInvaders.enemiesGroupCollection);n.init();d=f-1;while(d>=0){c=$.beget(SpaceInvaders.enemy);c.init(SpaceInvaders.spaceshipsModels[this.config.ENEMY_TYPE_NAME+g],this.config.ENEMY_TYPE_NAME+g);c.render();n.add(c);d-=1}this.enemiesCollection.addGroup(n,true);g=(e%2===0)?g-=1:g;e-=1;this.enemiesCollection.move(n)}this.stage.render();this.stage.append(this.enemiesCollection.render());this.enemiesCollection.animationStart();return this},pause:function(){},resume:function(){},restart:function(){this.shutdown();this.init()},shutdown:function(){while(this._active){this._active.pop().dispose()}}};SpaceInvaders.stage={init:function(b,a){this._width=b||"100%";this._height=a||"100%";return this},render:function(){this._$html=$('<div class="stage"></div>');this._$html.css({width:this._width,height:this._height,overflow:"hidden",position:"relative"});$("#wrapper").append(this._$html);return this},append:function(a){this._$html.append(a);return this._$html},html:function(){return this._$html},dispose:function(){}};SpaceInvaders.player={init:function(){this._$html;this._width;this._isFiring;this._isMoving},move:function(){},fire:function(){},html:function(){},destroy:function(){},dispose:function(){}};SpaceInvaders.enemy={init:function(a,b){this._model=a;this._type=b;this._destroyed=false},getType:function(){return this._type},getModel:function(){return this._model},move:function(b,a){},isDestroyed:function(){return this._destroyed},destroy:function(){this._$html.remove();this._destroyed=true},fire:function(){},html:function(){return this._$html},render:function(){if(!this._$html){console.log(this);var e=$('<div class="modelA '+this.getType()+'"></div>'),d=$('<div class="modelB '+this.getType()+'"></div>'),c=this.getModel().a,b=this.getModel().b,a=function(n,g){var o=n.length,m=0,k=0,h="",l=0,q,f;for(m=0;m<o;m+=1){q=$("<p></p>");f=n[m];l=f.length;for(k=0;k<l;k+=1){h=(f[k]==="p")?"black":"white";q.append('<span class="'+h+'">*</span>')}g.append(q)}return g};this._$html=$('<div class="enemy '+this.getType()+'"></div>').css({position:"absolute",width:SpaceInvaders.config.ENEMY_WIDTH,height:SpaceInvaders.config.ENEMY_HEIGHT});this._$html.append(a(c,e));this._$html.append(a(b,d))}return this._$html},dispose:function(){}};SpaceInvaders.enemiesGroupCollection={init:function(){return this},get:function(a){return this._enemies[a]},add:function(a){if(!this._enemies){this._enemies=[]}this._enemies.push(a);return this},render:function(){if(!this._$html){var b=this._enemies.length-1,a;this._$html=$('<div class="group"></div>').css({position:"absolute",width:(SpaceInvaders.config.ENEMY_WIDTH+SpaceInvaders.config.ENEMY_HORIZONTAL_MARGIN)*(b+1),height:SpaceInvaders.config.ENEMY_HEIGHT});for(b;b>=0;b-=1){a=this.get(b).render();a.css("left",46*b);this._$html.append(a)}}return this._$html},move:function(){},remove:function(){},dispose:function(){},size:function(){return this._enemies.length}};SpaceInvaders.enemiesCollection={init:function(){this._groups=[];this._enemies=[];return this},getGroup:function(a){return this._groups[a]},get:function(a,b){if(b){return this._group[b].get(a)}else{return this._enemies[a]}},add:function(a){this._enemies.push(a);return this},addGroup:function(c,b){this._groups.push(c);if(b){var a=c.size()-1;for(a;a>=0;a-=1){this.add(c.get(a))}}return this},render:function(){var a=0,b;if(!this._$html){this._$html=$('<div class="collection"></div>');this._$html.css({position:"absolute",width:(SpaceInvaders.config.ENEMY_WIDTH+SpaceInvaders.config.ENEMY_VERTICAL_MARGIN)*SpaceInvaders.config.ENEMY_COLUMNS,height:(SpaceInvaders.config.ENEMY_HEIGHT+SpaceInvaders.config.ENEMY_HORIZONTAL_MARGIN)*SpaceInvaders.config.ENEMY_ROWS});if(this._groups.length){a=this._groups.length-1;for(a;a>=0;a-=1){b=this.getGroup(a).render().css("top",(SpaceInvaders.config.ENEMY_HEIGHT+SpaceInvaders.config.ENEMY_VERTICAL_MARGIN)*a);this._$html.append(b)}}else{a=this._enemies.length-1;for(a;a>=0;a-=1){this._$html.append(this.get(a).render())}}this._$html.addClass("a")}return this._$html},animationStart:function(){var a=function(){if(this._$html.hasClass("a")){this._$html.removeClass("a").addClass("b")}else{this._$html.removeClass("b").addClass("a")}};if(this._interval){window.clearInterval(this._interval)}this._interval=window.setInterval($.proxy(a,this),1000);return this},animationStop:function(){if(this._interval){window.clearInterval(this._interval);this._interval=null;delete this._interval}return this},move:function(){var a=0,b;console.warn(this._groups)},remove:function(){},dispose:function(){this.animationStop();var a=0;if(this._groups.length){for(a;a>=0;a-=1){}}}};$(function(){$.beget=function(b){function a(){}if(Object.create){return Object.create(b)}else{a.prototype=b;return new a()}};$.getJSON("assets/spaceships.json",function(a){SpaceInvaders.spaceshipsModels=a;SpaceInvaders.init()})});$(window).on("unload",SpaceInvaders.shutdown);